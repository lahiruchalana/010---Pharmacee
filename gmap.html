<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pharmaceee | google map</title>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <style>
        #map {
            height: 650px;
            width: 100%;
        }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <link rel="stylesheet" type="text/css" href="./mapstyle.css" />
</head>
<body>
    <div>
        <nav class="navbar navbar-dark bg-dark" style="height: 70px;">
            <a class="navbar-brand" style="color: white; font-weight: 800;">PHARMACEE</a>
            <div class="form-inline">
                <!-- <input style="width: 450px; margin-right: 30px;" class="form-control mr-sm-2"  type="text" name="search" id="searchByTown" placeholder="Search by Town..." aria-label="Search"> -->
                <input id="pac-input" class="controls" type="text" placeholder="Search Box"/>
                <button id="myLocationButton" type="button" class="btn btn-primary" style="width: 250px; margin-right: -1100px; margin-top: 10px;">My Location</button>
                <button type="button" class="btn btn-primary" style="width: 150px;" onClick="location.href='../index.html'">Home</button>
            </div> 
        </nav>
    </div>

    <div id="map"></div>
    <script>

        // function initialize() {
        // initMap();
        // initAutocomplete();
        // }


        function initMap() {
            var options = {
                zoom:14,
                center:{lat:6.9271,lng:79.8612}
            }

            var map = new
            google.maps.Map(document.getElementById('map'), options)

            $.getJSON("data.json", function (data) {
                $.each(data, function (key, value) {
                    var latitude = parseFloat(value.Latitude)
                    var longitude = parseFloat(value.Longitude)
                    var coords = {lat:latitude,lng:longitude}
                    var name = value.Name
                    var address = value.Address
                    var phone = value.Phone
                    var whatsApp = value.WhatsApp
                    var viber = value.Viber
                    var info = `<h4>${name}</h4>` 
                    + `<h6>${address}</h6>` 
                    + `<h6>Phone : ${phone}</h6>`
                    + `<h6>WhatsApp : ${whatsApp}</h6>` 
                    + `<h6>Viber : ${viber}</h6>`
                    addMarker(coords, info)
                });

                function addMarker(coords, info) {
                    var marker = new google.maps.Marker({
                        position:coords,
                        map:map,
                        icon:'/images/cross.png'
                    })

                    console.log(coords, info)

                    var infoWindow = new google.maps.InfoWindow({
                        content:info
                    });

                    marker.addListener('click', function(){
                        infoWindow.open(map, marker)
                    })
                }
            });

            let infoWindow = new google.maps.InfoWindow();
            const locationButton = document.getElementById("myLocationButton");
            locationButton.textContent = "My Current Location";
            locationButton.classList.add("custom-map-control-button");
            map.controls[google.maps.ControlPosition.TOP_CENTER].push(locationButton);
            locationButton.addEventListener("click", () => {
                // Try HTML5 geolocation.
                if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                    const pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                    };
                    infoWindow.setPosition(pos);
                    infoWindow.setContent("<h6>Your Location...</h6>");
                    infoWindow.open(map);
                    map.setCenter(pos);
                    },
                    () => {
                    handleLocationError(true, infoWindow, map.getCenter());
                    }
                );
                } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
                }
            });

            
            
            
            
            
            
            // // Create a bounding box with sides ~10km away from the center point
            // const defaultBounds = {
            //     north: center.lat + 0.1,
            //     south: center.lat - 0.1,
            //     east: center.lng + 0.1,
            //     west: center.lng - 0.1,
            // };
            const input = document.getElementById("pac-input");
            // const options = {
            //     bounds: defaultBounds,
            //     componentRestrictions: { country: "us" },
            //     fields: ["address_components", "geometry", "icon", "name"],
            //     strictBounds: false,
            //     types: ["establishment"],
            // };
            const autocomplete = new google.maps.places.Autocomplete(input, options);
            
            






        }


        // function initAutocomplete() {
        //     const map = new google.maps.Map(document.getElementById("map"), {
        //         center: { lat: -33.8688, lng: 151.2195 },
        //         zoom: 13,
        //         mapTypeId: "roadmap",
        //     });
        //     // Create the search box and link it to the UI element.
        //     const input = document.getElementById("pac-input");
        //     const searchBox = new google.maps.places.SearchBox(input);
        //     map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
        //     // Bias the SearchBox results towards current map's viewport.
        //     map.addListener("bounds_changed", () => {
        //         searchBox.setBounds(map.getBounds());
        //     });
        //     let markers = [];
        //     // Listen for the event fired when the user selects a prediction and retrieve
        //     // more details for that place.
        //     searchBox.addListener("places_changed", () => {
        //         const places = searchBox.getPlaces();

        //         if (places.length == 0) {
        //         return;
        //         }
        //         // Clear out the old markers.
        //         markers.forEach((marker) => {
        //         marker.setMap(null);
        //         });
        //         markers = [];
        //         // For each place, get the icon, name and location.
        //         const bounds = new google.maps.LatLngBounds();
        //         places.forEach((place) => {
        //         if (!place.geometry || !place.geometry.location) {
        //             console.log("Returned place contains no geometry");
        //             return;
        //         }
        //         const icon = {
        //             url: place.icon,
        //             size: new google.maps.Size(71, 71),
        //             origin: new google.maps.Point(0, 0),
        //             anchor: new google.maps.Point(17, 34),
        //             scaledSize: new google.maps.Size(25, 25),
        //         };
        //         // Create a marker for each place.
        //         markers.push(
        //             new google.maps.Marker({
        //             map,
        //             icon,
        //             title: place.name,
        //             position: place.geometry.location,
        //             })
        //         );

        //         if (place.geometry.viewport) {
        //             // Only geocodes have viewport.
        //             bounds.union(place.geometry.viewport);
        //         } else {
        //             bounds.extend(place.geometry.location);
        //         }
        //         });
        //         map.fitBounds(bounds);
        //     });
    // }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(
            browserHasGeolocation
            ? "Error: The Geolocation service failed."
            : "Error: Your browser doesn't support geolocation."
        );
        infoWindow.open(map);
        }

    </script>
    <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACc5lUcG3lHSvqroAEOMaVOSUec9sr5fA&libraries=places&callback=initMap">
    </script>
    <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACc5lUcG3lHSvqroAEOMaVOSUec9sr5fA&callback=initAutocomplete&libraries=places&v=weekly"
    async defer>
    </script> -->

</body>
</html>